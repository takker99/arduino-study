# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±åˆå®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªçµ±åˆçµæœ

### çµ±åˆå‰ã®çŠ¶æ³
```
arduino-study/
â”œâ”€â”€ fan-control-project/
â”‚   â”œâ”€â”€ src/main.cpp
â”‚   â”œâ”€â”€ nodejs/server.js
â”‚   â””â”€â”€ nodejs/public/index.html
â””â”€â”€ science-data-logger/
    â”œâ”€â”€ src/ (ç©º)
    â””â”€â”€ public/ (ç©º)
```

### çµ±åˆå¾Œã®çŠ¶æ³
```
arduino-study/
â”œâ”€â”€ science-data-logger/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.cpp (Arduinoç”¨)
â”‚   â”‚   â”œâ”€â”€ server.ts (Hono + TypeScript)
â”‚   â”‚   â””â”€â”€ bindings-interface.d.ts
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ platformio.ini (ãƒ‘ã‚¹ä¿®æ­£æ¸ˆã¿)
â””â”€â”€ knowledge/
```

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯çµ±åˆ

### Arduinoå´
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `science-data-logger/src/main.cpp`
- **ãƒ“ãƒ«ãƒ‰**: `pio run -e fancontrol`
- **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: `pio run -e fancontrol --target upload`

### Node.jså´
- **å¾“æ¥**: Express + Socket.IO (JavaScript)
- **ç¾åœ¨**: Hono + Socket.IO (TypeScript + ESM)
- **èµ·å‹•**: `cd science-data-logger && npm start`

## âœ… ä¿®æ­£å®Œäº†é …ç›®

### 1. PlatformIOè¨­å®šä¿®æ­£
```ini
[env:fancontrol]
build_src_filter = +<science-data-logger/src/main.cpp>
```

### 2. TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«è¨­å®š
```json
{
  "start": "node --import tsx/esm src/server.ts"
}
```

### 3. WebSocketã‚µãƒ¼ãƒãƒ¼çµ±åˆ
- Honoã‚µãƒ¼ãƒãƒ¼ã¨åŒä¸€ãƒãƒ¼ãƒˆï¼ˆ3000ï¼‰ã§å‹•ä½œ
- Socket.IOã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡

### 4. READMEãƒ‘ã‚¹ä¿®æ­£
- ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹æ›´æ–°
- èµ·å‹•æ‰‹é †ã®çµ±ä¸€

## ğŸš€ å‹•ä½œç¢ºèªçµæœ

### ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
```bash
$ curl http://localhost:3000
# âœ… Web UI (HTML) ãŒæ­£å¸¸ã«è¿”ã•ã‚Œã‚‹
```

### APIå‹•ä½œç¢ºèª
- `/api/status` - ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—
- `/api/history` - å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—
- `/api/control` - åˆ¶å¾¡ã‚³ãƒãƒ³ãƒ‰é€ä¿¡
- `/api/export` - CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### WebSocketæ¥ç¶š
- Socket.IOã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šå¯¾å¿œ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿é…ä¿¡
- åˆ¶å¾¡ã‚³ãƒãƒ³ãƒ‰åŒæ–¹å‘é€šä¿¡

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

### TypeScriptåŒ–ã«ã‚ˆã‚‹åˆ©ç‚¹
1. **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡º
2. **é–‹ç™ºåŠ¹ç‡**: IDEã‚µãƒãƒ¼ãƒˆå‘ä¸Š
3. **ä¿å®ˆæ€§**: å¤§è¦æ¨¡é–‹ç™ºå¯¾å¿œ

### Honoæ¡ç”¨ã«ã‚ˆã‚‹åˆ©ç‚¹
1. **è»½é‡**: Expressæ¯”ã§é«˜é€Ÿå‹•ä½œ
2. **ãƒ¢ãƒ€ãƒ³**: Web Standardsæº–æ‹ 
3. **TypeScript**: ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. Arduinoå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ
```bash
# ã‚»ãƒ³ã‚µãƒ¼æ¥ç¶šå¾Œã®ãƒ†ã‚¹ãƒˆ
pio run -e fancontrol --target upload
pio device monitor --baud 9600
```

### 2. ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–æ‹¡å¼µ
- Chart.jsã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚°ãƒ©ãƒ•
- çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆè¡¨ç¤º
- ç•°å¸¸å€¤æ¤œå‡ºã‚¢ãƒ©ãƒ¼ãƒˆ

### 3. ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API
- ãƒ­ã‚°è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ 
- ã‚¨ãƒ©ãƒ¼å‡¦ç†å¼·åŒ–

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. Arduinoæ¥ç¶šã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: `Arduino not found`
**è§£æ±º**:
```bash
# ãƒãƒ¼ãƒˆæ¨©é™ç¢ºèª
sudo usermod -a -G dialout $USER
# USBãƒ‡ãƒã‚¤ã‚¹ç¢ºèª
lsusb | grep Arduino
```

#### 2. npm start ã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: `tsx must be loaded with --import`
**è§£æ±º**: âœ… ä¿®æ­£æ¸ˆã¿ï¼ˆ`--import tsx/esm`ä½¿ç”¨ï¼‰

#### 3. WebSocketæ¥ç¶šå¤±æ•—
**ç—‡çŠ¶**: Socket.IOæ¥ç¶šã‚¨ãƒ©ãƒ¼
**è§£æ±º**: âœ… ä¿®æ­£æ¸ˆã¿ï¼ˆåŒä¸€ãƒãƒ¼ãƒˆçµ±åˆï¼‰

## ğŸ› é–‹ç™ºä¸­ã«ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œã¨è§£æ±ºç­–

### Vite + Hono + WebSocketç«¶åˆå•é¡Œ

**ç™ºç”Ÿæ—¥**: 2025å¹´7æœˆ5æ—¥

**ç—‡çŠ¶**:
- `npm run dev`å®Ÿè¡Œæ™‚ã«WebSocketã‚¨ãƒ©ãƒ¼ãŒé€£ç¶šç™ºç”Ÿ
- `ReferenceError: ErrorEvent is not defined`
- `ws proxy socket error: Error: write EPIPE`
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ç„¡é™ãƒªãƒ­ãƒ¼ãƒ‰

**åŸå› **:
Viteã®HMR (Hot Module Replacement) ã‚µãƒ¼ãƒãƒ¼ã¨Hono+WebSocketã‚µãƒ¼ãƒãƒ¼ãŒåŒã˜ãƒãƒ¼ãƒˆç©ºé–“ã§ç«¶åˆã€‚

**è§£æ±ºç­–**:
`vite.config.ts`ã§HMRãƒãƒ¼ãƒˆã‚’åˆ†é›¢:
```typescript
export default defineConfig({
  server: {
    hmr: {
      port: 24678, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5173ä»¥å¤–ã®å°‚ç”¨ãƒãƒ¼ãƒˆ
    },
  },
  // ...existing plugins
});
```

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**:
- Viteã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã¯è¤‡æ•°ã®WebSocketã‚’ä½¿ç”¨ï¼ˆHMR + ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- ãƒãƒ¼ãƒˆç«¶åˆã¯å¿…ãšã—ã‚‚`EADDRINUSE`ã‚¨ãƒ©ãƒ¼ã§æ˜ç¤ºã•ã‚Œãªã„
- `@hono/node-ws`ã¨Viteã®WebSocketãƒ—ãƒ­ã‚­ã‚·ã¯æ…é‡ãªè¨­å®šãŒå¿…è¦

## ğŸ‰ çµ±åˆå®Œäº†

**ç¾åœ¨ã®çŠ¶æ…‹**: å…¨æ©Ÿèƒ½ãŒ`science-data-logger`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«çµ±åˆã•ã‚Œã€TypeScript + Honoãƒ™ãƒ¼ã‚¹ã®ãƒ¢ãƒ€ãƒ³ãªæ§‹æˆã§å‹•ä½œä¸­ã€‚

**å‹•ä½œç¢ºèª**:
- ã‚µãƒ¼ãƒãƒ¼èµ·å‹•: âœ…
- Web UIè¡¨ç¤º: âœ…
- APIå¿œç­”: âœ…
- ãƒ“ãƒ«ãƒ‰è¨­å®š: âœ…
- WebSocketé€šä¿¡: âœ… (HMRãƒãƒ¼ãƒˆåˆ†é›¢ã«ã‚ˆã‚Šè§£æ±º)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çµ±åˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ğŸŠ
