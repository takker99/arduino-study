# 扇風機制御型データロガー - 詳細仕様

## 🎯 プロジェクト概要

**コンセプト**: 温度・湿度に応じて扇風機の回転速度を自動制御し、その効果をリアルタイムで監視するシステム

### 制御ロジック
```
温度制御:
├── 25°C以下: 扇風機停止
├── 25-28°C: 低速回転（30% PWM）
├── 28-32°C: 中速回転（60% PWM）
└── 32°C以上: 高速回転（100% PWM）

湿度制御:
├── 60%RH以下: 湿度上昇モード（低速）
├── 60-70%RH: 標準モード
└── 70%RH以上: 除湿モード（高速）
```

## 🔧 ハードウェア構成

### 使用部品
- **センサー**:
  - DHT22 (温度・湿度センサー)
  - 光センサー (LDR)
  - 音センサー (風切り音検出)
- **アクチュエーター**:
  - DCモーター + 扇風機の羽
  - RGB LED (状態表示)
  - ブザー (警告音)
- **表示**:
  - LCD 16x2 (現在値表示)
  - 7セグメント (風速レベル表示)
- **入力**:
  - ボタン x3 (手動制御、設定切替)
  - ポテンショメーター (手動風速調整)

### 配線図
```
Arduino UNO ピン配置:
├── デジタルピン
│   ├── D2: DHT22 データ
│   ├── D3: DCモーター PWM制御
│   ├── D4-D7: LCD制御
│   ├── D8-D10: ボタン入力
│   ├── D11: ブザー
│   └── D12-D13: RGB LED
└── アナログピン
    ├── A0: 光センサー
    ├── A1: 音センサー
    └── A2: ポテンショメーター
```

## 💻 ソフトウェア構成

### Arduino側 (main.cpp)
```cpp
主要機能:
├── センサー値読み取り (1秒間隔)
├── 制御ロジック実行
├── PWM制御によるモーター速度調整
├── LCD表示更新
├── シリアル通信 (JSON形式)
└── 手動制御モード切替
```

### Node.js側
```javascript
主要機能:
├── Express サーバー
├── SerialPort による Arduino通信
├── WebSocket でリアルタイム更新
├── SQLite データベース
├── Chart.js による可視化
└── 制御コマンド送信
```

### Web UI
```html
ダッシュボード構成:
├── リアルタイム監視パネル
│   ├── 温度・湿度グラフ
│   ├── 風速レベル表示
│   └── 環境光・音レベル
├── 制御パネル
│   ├── 自動/手動モード切替
│   ├── 手動風速調整
│   └── 設定値変更
└── データ分析パネル
    ├── 時系列データ表示
    ├── 統計情報
    └── CSVエクスポート
```

## 🚀 実装フェーズ

### Phase 1: 基本機能 (2-3時間)
```
1. Arduino基本制御
   ├── センサー読み取り
   ├── DCモーター制御
   └── LCD表示

2. Node.js基本サーバー
   ├── Express設定
   ├── シリアル通信
   └── 基本Web UI

3. 動作確認
   ├── センサー値表示
   └── 手動風速制御
```

### Phase 2: 自動制御 (1-2時間)
```
1. 制御ロジック実装
   ├── 温度による制御
   ├── 湿度による制御
   └── 優先度設定

2. Web UI改良
   ├── リアルタイム表示
   ├── 制御パネル
   └── グラフ表示
```

### Phase 3: 完成度向上 (1時間)
```
1. データ保存機能
   ├── SQLite連携
   ├── 履歴表示
   └── 統計分析

2. 仕上げ
   ├── エラーハンドリング
   ├── UI改良
   └── 動作テスト
```

## 📊 データ構造

### Arduino → Node.js (JSON)
```json
{
  "timestamp": 1725360000,
  "temperature": 26.5,
  "humidity": 65.2,
  "light": 512,
  "sound": 45,
  "fanSpeed": 60,
  "mode": "auto",
  "manualSpeed": 0
}
```

### Node.js → Arduino (コマンド)
```json
{
  "command": "setMode",
  "mode": "manual",
  "speed": 80
}
```

## 🔍 制御アルゴリズム

### 温度制御
```cpp
int calculateFanSpeed(float temp, float humidity) {
    int tempSpeed = 0;
    int humiditySpeed = 0;

    // 温度ベース制御
    if (temp < 25) tempSpeed = 0;
    else if (temp < 28) tempSpeed = 30;
    else if (temp < 32) tempSpeed = 60;
    else tempSpeed = 100;

    // 湿度ベース制御
    if (humidity < 60) humiditySpeed = 20;
    else if (humidity > 70) humiditySpeed = 80;
    else humiditySpeed = 40;

    // 最終速度決定（最大値を採用）
    return max(tempSpeed, humiditySpeed);
}
```

### 学習機能（発展的）
- 過去のデータから最適な制御パラメータを学習
- 環境変化の予測による先行制御
- ユーザーの手動調整履歴から好みを学習

## 🎯 成功指標

### 技術的成果
- [ ] センサー値の安定した読み取り
- [ ] 滑らかな風速制御
- [ ] 1秒以内のリアルタイム更新
- [ ] 24時間連続稼働

### 学習効果
- [ ] PWM制御の理解
- [ ] PID制御の基礎
- [ ] WebSocketによるリアルタイム通信
- [ ] データベース連携

この仕様で、約4-6時間で完成できる実用的なシステムを構築できます。すぐに実装を開始しましょう！
